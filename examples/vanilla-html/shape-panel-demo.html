<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å½¢çŠ¶åº“ - Shape Library Demo</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    canvas-drawing-editor { width: 100%; height: calc(100vh - 60px); display: block; }
    .demo-toolbar {
      height: 60px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      padding: 0 20px;
      gap: 12px;
    }
    .demo-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .demo-btn-primary {
      background: #5450dc;
      color: white;
    }
    .demo-btn-primary:hover {
      background: #4338ca;
    }
    .demo-btn-success {
      background: #22c55e;
      color: white;
    }
    .demo-btn-success:hover {
      background: #16a34a;
    }
    .demo-title {
      font-size: 16px;
      font-weight: 600;
      color: #334155;
      margin-right: auto;
    }
    #exportResult {
      margin-left: 12px;
      font-size: 13px;
      color: #64748b;
    }
  </style>
</head>
<body>
  <div class="demo-toolbar">
    <span class="demo-title">ğŸ“ å½¢çŠ¶åº“æ¼”ç¤º - Shape Library Demo</span>
    <button class="demo-btn demo-btn-primary" onclick="exportAsDataURL()">å¯¼å‡º DataURL</button>
    <button class="demo-btn demo-btn-success" onclick="exportAsBlob()">å¯¼å‡º Blob</button>
    <span id="exportResult"></span>
  </div>

  <canvas-drawing-editor
    id="editor"
    title="å½¢çŠ¶åº“æ¼”ç¤º"
    lang="zh"
    theme-color="#5450dc"
  ></canvas-drawing-editor>

  <script src="../../dist/canvas-drawing-editor.umd.js"></script>
  <script>
    const editor = document.getElementById('editor');
    const resultSpan = document.getElementById('exportResult');

    // å¯¼å‡ºä¸º DataURL (base64)
    async function exportAsDataURL() {
      try {
        resultSpan.textContent = 'å¯¼å‡ºä¸­...';
        const dataURL = await editor.getImageData({
          format: 'png',
          background: '#ffffff'
        });
        console.log('DataURL:', dataURL);
        resultSpan.textContent = `âœ… DataURL å¯¼å‡ºæˆåŠŸï¼é•¿åº¦: ${dataURL.length} å­—ç¬¦`;

        // å¯é€‰ï¼šåœ¨æ–°çª—å£é¢„è§ˆ
        const win = window.open();
        win.document.write(`<img src="${dataURL}" style="max-width:100%">`);
      } catch (err) {
        resultSpan.textContent = `âŒ å¯¼å‡ºå¤±è´¥: ${err.message}`;
        console.error(err);
      }
    }

    // å¯¼å‡ºä¸º Blob
    async function exportAsBlob() {
      try {
        resultSpan.textContent = 'å¯¼å‡ºä¸­...';
        const blob = await editor.getImageData({
          format: 'png',
          type: 'blob',
          background: '#ffffff'
        });
        console.log('Blob:', blob);
        resultSpan.textContent = `âœ… Blob å¯¼å‡ºæˆåŠŸï¼å¤§å°: ${(blob.size / 1024).toFixed(2)} KB`;

        // åˆ›å»ºä¸‹è½½é“¾æ¥
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `canvas-export-${Date.now()}.png`;
        a.click();
        URL.revokeObjectURL(url);
      } catch (err) {
        resultSpan.textContent = `âŒ å¯¼å‡ºå¤±è´¥: ${err.message}`;
        console.error(err);
      }
    }

    // é¡µé¢åŠ è½½åæ³¨å†Œå½¢çŠ¶
    setTimeout(() => {
      // è°ƒè¯•ï¼šæ£€æŸ¥å½¢çŠ¶åº“æŒ‰é’®æ˜¯å¦å­˜åœ¨
      const shapeLibraryBtn = editor.shadowRoot.querySelector('.shape-library-btn');
      console.log('å½¢çŠ¶åº“æŒ‰é’®:', shapeLibraryBtn);

      // ç”Ÿæˆæ—¶é—´æˆ³ID
      let idCounter = 0;
      const generateId = () => 'T' + Date.now() + (idCounter++).toString().padStart(3, '0');

      // ç”Ÿæˆé¢œè‰²æ•°ç»„
      const colors = [
        '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',
        '#06b6d4', '#ec4899', '#84cc16', '#f97316', '#6366f1',
        '#14b8a6', '#a855f7', '#22c55e', '#eab308', '#0ea5e9'
      ];

      // å½¢çŠ¶ç±»å‹
      const shapeTypes = ['rectangle', 'circle', 'triangle', 'star', 'heart', 'diamond', 'hexagon', 'ellipse', 'roundedRect'];

      // ç”ŸæˆåŸºç¡€å½¢çŠ¶
      const basicShapes = [];
      for (let i = 0; i < 20; i++) {
        const color = colors[i % colors.length];
        const type = shapeTypes[i % shapeTypes.length];
        basicShapes.push({
          id: `shape-${i + 1}`,
          name: generateId(),
          type: type,
          category: 'åŸºç¡€',
          fillColor: color,
          fillMode: 'both',
          strokeColor: color,
          strokeWidth: 2,
          width: 80 + (i % 3) * 20,
          height: 60 + (i % 3) * 20,
          cornerRadius: type === 'roundedRect' ? 8 : 0
        });
      }

      // ç”Ÿæˆå¸¦æ–‡å­—çš„æŒ‰é’®å½¢çŠ¶
      const buttonColors = ['#22c55e', '#ef4444', '#3b82f6', '#8b5cf6', '#f59e0b', '#06b6d4', '#ec4899', '#84cc16'];

      const buttonShapes = [];
      for (let i = 0; i < 20; i++) {
        buttonShapes.push({
          id: `btn-${i + 1}`,
          name: generateId(),
          type: 'roundedRect',
          category: 'æŒ‰é’®',
          fillColor: buttonColors[i % buttonColors.length],
          fillMode: 'fill',
          strokeWidth: 0,
          cornerRadius: 8,
          width: 100,
          height: 40,
          text: generateId(),
          textColor: '#ffffff',
          fontSize: 14,
          fontWeight: 'bold'
        });
      }

      // ç”Ÿæˆæµç¨‹å›¾å½¢çŠ¶
      const flowTypes = ['ellipse', 'ellipse', 'rectangle', 'diamond', 'parallelogram', 'parallelogram', 'rectangle', 'rectangle', 'hexagon', 'rectangle'];

      const flowShapes = [];
      for (let i = 0; i < 10; i++) {
        flowShapes.push({
          id: `flow-${i + 1}`,
          name: generateId(),
          type: flowTypes[i % flowTypes.length],
          category: 'æµç¨‹å›¾',
          fillColor: '#dbeafe',
          fillMode: 'both',
          strokeColor: '#3b82f6',
          strokeWidth: 2,
          width: 100,
          height: i === 3 ? 100 : 60,
          text: generateId(),
          textColor: '#1e40af',
          fontSize: 14
        });
      }

      // æ³¨å†Œæ‰€æœ‰å½¢çŠ¶
      editor.registerShapes([...basicShapes, ...buttonShapes, ...flowShapes]);

      console.log('å½¢çŠ¶å·²æ³¨å†Œï¼å…±', basicShapes.length + buttonShapes.length + flowShapes.length, 'ä¸ªå½¢çŠ¶');
    }, 300);

    // ç›‘å¬å½¢çŠ¶æ·»åŠ äº‹ä»¶
    editor.addEventListener('shape-added', (e) => {
      console.log('å½¢çŠ¶å·²æ·»åŠ åˆ°ç”»å¸ƒ:', e.detail.shape.name);
      console.log('åˆ›å»ºçš„å¯¹è±¡:', JSON.stringify(e.detail.object, null, 2));
    });
  </script>
</body>
</html>

